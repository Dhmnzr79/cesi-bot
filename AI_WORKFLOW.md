# AI Workflow для CESI-bot

## Обязательный порядок работы:
1. **Прочитать .cursorrules** полностью
2. **Показать ПЛАН** и список файлов, которые тронешь
3. **Ждать команду "GO"** перед началом правок
4. **Найти опасные шаблоны:** [:700], answer_len, прямые return jsonify(raw_llm_dict)
5. **Вносить правки** с обратной совместимостью импортов
6. **Логировать** перед return в /chat: final_answer с len, truncated, cta

## Строгие запреты:
- ❌ Никаких широких рефакторингов - только минимальный diff
- ❌ Не удалять/переименовывать: init_logging(), /admin/log-self-test, экспорты log_m/log_resp/log
- ❌ Запрещено резать ответы вне финализатора (никаких [:700], [:650], [:220])
- ❌ Нельзя возвращать сырые ответы модели в обход нормализации

## Лимиты ответов:
- contacts ~300 символов
- prices/prices_short/warranty ~420 символов  
- doctors ~360 символов
- consultation ~480 символов
- safety/contraindications ~520 символов
- empathy ≤ 200 символов

## Definition of Done:
- ✅ Логи пишутся (minimal_logs.jsonl, bot_responses.jsonl)
- ✅ Ответы проходят через finalize_answer и соответствуют лимитам
- ✅ Нет срезов ответов вне финализатора и старых логов answer_len
